#!/usr/bin/env python3
import random
import requests
from datetime import datetime

flags=['ABCDEFGHI']
key=int(datetime.now().second)

alpha=[chr(x) for x in range(0x30,0x3a)]
alpha+=[chr(x) for x in range(0x61,0x7b)]
stack="".join([random.choice(alpha) for x in range(128)])

def popstack():
    global stack
    ret_val = stack[:8]
    stack = stack[8:]
    return ret_val

def get_flag():
    global stack
    try:
        port=int(popstack())
        parameter=popstack()[:4]
        data_enc=popstack()
        print(data_enc)
        data=""
        for x in data_enc:
            data+=chr(ord(x)+key)
        content=f"http://0.0.0.0:{port}/?{parameter}={data}"
        print(content)
        if data =='REALFLAG':
            print('CTFR{REDACTED}')
    except Exception as e:
        print(e)
        exit(1)

def vuln():
    global stack
    user=input("> ").ljust(16, " ")
    stack=user[:48]+stack
    stack=stack[16:]
    ret_addr=popstack()
    try:
        globals()[ret_addr]()
    except Exception as e:
        print(e)
        exit(1)

if __name__ == "__main__":
    print(f"Detik: {key}")
    vuln()